{{ header }}{{ column_left }}
<div id="content">
    <div class="page-header">
        <div class="container-fluid">
            <div class="pull-right">
                <button type="submit" form="form-retargeting" data-toggle="tooltip" title="{{ button_save }}" class="btn btn-primary"><i class="fa fa-save"></i></button>
                <a href="{{ cancel }}" data-toggle="tooltip" title="{{ button_cancel }}" class="btn btn-default"><i class="fa fa-reply"></i></a>
            </div>
            <h1>{{ heading_title }}</h1>
            <ul class="breadcrumb">
                {% for breadcrumb in breadcrumbs %}
                    <li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
                {% endfor %}
            </ul>
        </div>
    </div>
    <div class="container-fluid">
        {% if error_warning %}
        <div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> {{ error_warning }}
            <button type="button" class="close" data-dismiss="alert">&times;</button>
        </div>
        {% endif %}
        <div class="panel panel-default">

            <!-- Module inline title -->
            <div class="panel-heading">
                <h3 class="panel-title"><i class="fa fa-paper-plane"></i> {{ text_edit }}</h3>
            </div>

            <div class="panel-body">

                <!-- Retargeting logo/img -->
                <div class="row" style="min-height:45px;">
                    <div class="col-md-12">
                        <img src="https://retargeting.ro/static/images/i/logo.png" class="img-responsive" alt="Retargeting Tracker" />
                    </div>
                </div>

                <!-- Sign up pop-up message -->
                {% if module_retargeting_apikey is not defined and module_retargeting_apikey is empty %}
                    <div class="alert alert-info"><i class="fa fa-info-circle"></i> {{ text_signup }}
                        <button type="button" class="close" data-dismiss="alert">x</button>
                    </div>
                {% endif %}

                <!-- Submission form -->
                <form action="{{ action }}" method="post" enctype="multipart/form-data" id="form-retargeting" class="form-horizontal">
                    
                    <!-- API KEY -->
                    <div class="form-group">
                        <label class="col-sm-2 control-label" for="input-apikey">{{ entry_apikey }}</label>
                        <div class="col-sm-10">
                            <input type="text" name="module_retargeting_apikey" value="{{ module_retargeting_apikey }}" placeholder="{{ entry_apikey}}" id="input-apikey" class="form-control" />
                            {% if error_code %}
                            <div class="text-danger">{{ error_code}}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- REST API KEY -->
                    <div class="form-group">
                        <label class="col-sm-2 control-label" for="input-token">{{ entry_token }}</label>
                        <div class="col-sm-10">
                            <input type="text" name="module_retargeting_token" value="{{ module_retargeting_token }}" placeholder="{{ entry_token }}" id="input-token" class="form-control" />
                        </div>
                    </div>

                    <!-- Enabled/Disabled status -->
                    <div class="form-group">
                        <label class="col-sm-2 control-label" for="input-status">{{ entry_status }}</label>
                        <div class="col-sm-10">
                            <select name="module_retargeting_status" id="input-status" class="form-control">
                              {% if module_retargeting_status %}
                              <option value="1" selected="selected">{{ text_enabled }}</option>
                              <option value="0">{{ text_disabled }}</option>
                              {% else %}
                              <option value="1">{{ text_enabled }}</option>
                              <option value="0" selected="selected">{{ text_disabled }}</option>
                              {% endif %}
                            </select>
                        </div>
                    </div>

                    <!-- Layouts -->
                    <div class="form-group">
                        <label class="col-sm-2 control-label" for="retargeting_module">Assigned Layouts:</label>
                        <div class="col-sm-10">
                            {% for layout in layouts %}
                            <span class="label label-default" name="{{ layout.name }}">{{ layout.name }}</span>
                            {% endfor %}
                        </div>
                    </div>

                    <hr />

                    <!-- Recommendation Engine pop-up message -->
                    <div class="alert alert-info" id="retargeting-recomeng-pop"><i class="fa fa-info-circle"></i>{{ text_layout }}
                        <button type="button" id="close-recomeng-pop" class="close" data-dismiss="alert">&times;</button>
                    </div>
                    <!-- Webshop Personalization -->
                    <div class="col-sm-2" style="color:forestgreen">
                        <h3>Webshop Personalization</h3>
                    </div>
                    <div class="col-sm-10">
                        <div class="well">
                            Allows the display of customized products carousel on your website pages. Please go to Layouts and add the Recommendation Engine modules for their respective page.
                            <i>i.e: 'Recommendation Engine Home Page' goes into 'Home' layer</i>
                        </div>
                    </div>

                    <!-- Recommendation Engine Enable Disable -->
                    <div class="form-group">
                        <label class="col-sm-2 control-label" for="input-recomeng">{{ entry_recomeng }}</label>
                        <div class="col-sm-10">
                            <select name="module_retargeting_recomeng" id="input-recomeng" class="form-control">
                                <option value="1" {{ module_retargeting_recomeng == true ? 'selected="selected"' : '' }}>{{ text_recomengEnabled}}</option>
                                <option value="0" {{ module_retargeting_recomeng == false ? 'selected="selected"' : '' }}>{{ text_recomengDisabled }}</option>
                            </select>
                            <br>
                            <div class="alert alert-success" id="recomeng-response-msg" style="display: none"><b>Activated!</b>
                                <button type="button" id="close-recomeng-pop" class="close" data-dismiss="alert">&times;</button>
                            </div>
                        </div>
                    </div>
                    <br>
                    <hr>
                    <br>
                    <br>

                    <!-- Fine Tuning -->
                    <div class="col-sm-2" style="color:dodgerblue">
                        <h3>Fine tuning</h3>
                    </div>
                    <div class="col-sm-10">
                        <div class="well">
                            Your OpenCart theme may alter certain CSS and HTML elements that are important for Retargeting Tracker. Below you can adjust the CSS selectors which Retargeting Tracker will be monitoring. Please use single quotes only. Example: input[type='text']
                        </div>
                    </div>

                    <!-- 1. setEmail -->
                    <div class="form-group">
                        <label class="col-sm-2 control-label" for="input-setEmail">{{ entry_email }}</label>
                        <div class="col-sm-10">
                            <input type="text" name="module_retargeting_setEmail" value="{{ module_retargeting_setEmail is defined and module_retargeting_setEmail is not empty ? module_retargeting_setEmail : "input[type=\'text\']" }}" placeholder="input[type=\'text\']" id="input-setEmail" class="form-control" />
                            <span class="small">Email input query selector.</span>
                        </div>
                    </div>

                    <!-- 2. addToCart -->
                    <div class="form-group">
                        <label class="col-sm-2 control-label" for="input-addToCart">{{ entry_cart_button }}</label>
                        <div class="col-sm-10">
                            <input type="text" name="module_retargeting_addToCart" value="{{ module_retargeting_addToCart is defined and module_retargeting_addToCart is not empty ? module_retargeting_addToCart : "#button-cart" }}" placeholder="#button-cart" id="input-addToCart" class="form-control" />
                            <span class="small">Cart button query selector.</span>
                        </div>
                    </div>

                    <!-- 3. clickImage -->
                    <div class="form-group">
                        <label class="col-sm-2 control-label" for="input-clickImage">{{ entry_image }}</label>
                        <div class="col-sm-10">
                            <input type="text" name="module_retargeting_clickImage" value="{{ module_retargeting_clickImage is defined and module_retargeting_clickImage is not empty ? module_retargeting_clickImage : "a.thumbnail" }}" placeholder="a.thumbnail" id="input-clickImage" class="form-control" />
                            <span class="small">Main product image container query selector.</span>
                        </div>
                    </div>

                    <div class="row" style="padding-top: 45px;">
                        <hr />
                        <div class="col-sm-12">
                            <span class="small">You can get your <strong>Tracking API Key</strong> and <strong>REST API Key</strong> from your <a href="https://retargeting.biz/" target="_blank" rel="noopener noreferrer">Retargeting account</a>.</span>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{{ footer }}
<script>
    jQuery(document).ready(function() {
        jQuery("#input-recomeng").on("change", function() {
            var state = $(this).val();
            if (state == 1) {
                var data = {'action': 'insert'};
                recommendationEngineSettings(data);
            } else {
                var data = {'action': 'delete'};
                recommendationEngineSettings(data);
            }
        });
    });
    /**
     * Sends AJAX request to Retargeting Tracker Admin Settings page
     * regarding Recommendation Engine Enable and Disable statuses.
     * @param [object] data
     * @return object
     */
    function recommendationEngineSettings(data) {
        jQuery.ajax({
            type: 'post',
            url: 'index.php?route={{ route }}/ajax&user_token={{ token }}',
            data: data,
            dataType: 'json',
            success: function(json) {
                console.log(json.state);
                if (json.state) {
                    jQuery("#recomeng-response-msg").show();
                } else {
                    jQuery("#recomeng-response-msg").hide();
                }
            },
            error: function(e) {
                console.log('Error 01: Recommendation Engine AJAX call failed! Please contact us at info@retargeting.biz');
                console.log(e);
            }
        });
    }
    // Dismiss Recommendation Engine pop-up message
    jQuery(document).ready(function() {
        jQuery("#close-recomeng-pop").on('click', function() {
            sessionStorage.setItem('_ra_hidden', 'true');
        });
        var retSession = sessionStorage.getItem('_ra_hidden');
        if ( retSession  ) {
            jQuery("#retargeting-recomeng-pop").hide();
        }
    });
</script>

